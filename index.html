<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korean Diet - ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</title>
    
    <!-- Facebook Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}
    (window, document,'script','https://connect.facebook.net/en_US/fbevents.js');

    fbq('init','1816534509233210');   // ‚úÖ ÎÑ§ ÌîΩÏÖÄ ID
    fbq('track','PageView');          // ÌéòÏù¥ÏßÄ ÏßÑÏûÖ Ï∂îÏ†Å
    </script>
    <noscript>
      <img height="1" width="1" style="display:none"
           src="https://www.facebook.com/tr?id=1816534509233210&ev=PageView&noscript=1" />
    </noscript>
    <!-- End Facebook Pixel Code -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 30px;
            text-align: center;
        }

        /* Ìó§Îçî Ïù¥ÎØ∏ÏßÄ Ïä§ÌÉÄÏùº */
        .header-images {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .header-image-container {
            max-width: 700px;
            width: 100%;
        }

        .header-image {
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            object-fit: cover;
        }

        /* ÏÑ§Î¨∏ Ìèº Ïä§ÌÉÄÏùº */
        .form-section {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group input[type="text"],
        .form-group input[type="tel"],
        .form-group input[type="email"],
        .form-group input[type="number"],
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .radio-option:hover {
            background: #f0f0f0;
        }

        .radio-option input[type="radio"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .radio-option.selected {
            background: #e8edff;
            border-color: #667eea;
        }

        .bmi-display {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .bmi-display strong {
            color: #2e7d32;
            font-size: 1.5rem;
        }

        .submit-button {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px;
            border: none;
            border-radius: 25px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: transform 0.2s;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ Ïä§ÌÉÄÏùº */
        .result-container {
            text-align: center;
            padding: 40px 20px;
        }

        .result-icon {
            width: 80px;
            height: 80px;
            background: #4caf50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .result-icon::after {
            content: '‚úì';
            color: white;
            font-size: 3rem;
            font-weight: bold;
        }

        .result-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 30px;
        }

        .result-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .result-box .diagnosis {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .line-info {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }

        .line-info a {
            color: #00c851;
            font-weight: bold;
            text-decoration: none;
        }

        .reset-button {
            display: inline-block;
            background: #6c757d;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }

        .reset-button:hover {
            background: #5a6268;
        }

        .hidden {
            display: none;
        }

        .instruction {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .step {
            margin: 15px 0;
            font-size: 1.1rem;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }

        .line-button {
            display: inline-block;
            background: #00c851;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 20px 0;
            transition: background 0.3s ease;
        }

        .line-button:hover {
            background: #007e33;
        }

        .contact-info {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #ffeaa7;
        }

        .hours {
            font-weight: bold;
            color: #e17055;
        }

        .auto-redirect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 1000;
        }

        .loading {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .logo {
                font-size: 2rem;
            }

            .form-section {
                padding: 15px;
            }

            .header-images {
                margin: 20px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">Korean Diet</div>

        <!-- Ìó§Îçî Ïù¥ÎØ∏ÏßÄ -->
        <div class="header-images">
            <div class="header-image-container">
                <img src="header-image.png" alt="Korean Diet" class="header-image">
            </div>
        </div>

        <div class="subtitle">‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</div>

        <!-- ÏÑ§Î¨∏ Ìèº -->
        <div id="survey-container">
            <form id="diagnosis-form">
                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
                <div class="form-section">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>

                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© <span style="color: red;">*</span></label>
                        <input type="text" name="fullName" id="fullName" required placeholder="John Smith">
                    </div>

                    <div class="form-group">
                        <label>‡πÑ‡∏•‡∏ô‡πå‡πÑ‡∏≠‡∏î‡∏µ (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏≠‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ) <span style="color: red;">*</span></label>
                        <input type="text" name="lineId" id="lineId" required placeholder="@yourlineid">
                    </div>

                    <div class="form-group">
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå <span style="color: red;">*</span></label>
                        <input type="tel" name="phoneNumber" id="phoneNumber" required
                               pattern="\d{8,15}"
                               title="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (8-15 ‡∏´‡∏•‡∏±‡∏Å ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)"
                               placeholder="0812345678">
                        <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                            ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 0812345678 (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 8-15 ‡∏´‡∏•‡∏±‡∏Å ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ç‡∏µ‡∏î)
                        </p>
                    </div>

                    <div class="form-group">
                        <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="email" name="email" id="email"
                               placeholder="example@email.com">
                        <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                            ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
                        </p>
                    </div>
                </div>

                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û -->
                <div class="form-section">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h3>

                    <div class="form-group">
                        <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (kg) <span style="color: red;">*</span></label>
                        <input type="number" name="currentWeight" id="currentWeight" required step="0.1" min="0" placeholder="60.5">
                    </div>

                    <div class="form-group">
                        <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm) <span style="color: red;">*</span></label>
                        <input type="number" name="height" id="height" required step="0.1" min="0" placeholder="165">
                    </div>

                    <div id="bmi-display" class="bmi-display hidden">
                        <p>BMI ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <strong id="bmi-value">-</strong></p>
                    </div>
                </div>

                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢ -->
                <div class="form-section">
                    <h3>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h3>

                    <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 1 -->
                    <div class="form-group">
                        <label>1. ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? <span style="color: red;">*</span></label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="past_med_exp" value="has_experience" required>
                                <span>‡πÄ‡∏Ñ‡∏¢ (ÎÑ§)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="past_med_exp" value="no_experience">
                                <span>‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢ (ÏïÑÎãàÏò§)</span>
                            </label>
                        </div>
                    </div>

                    <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 2 -->
                    <div class="form-group">
                        <label>2. ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡∏ï‡πà‡∏≠‡∏Ñ‡∏≤‡πÄ‡∏ü‡∏≠‡∏µ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏∑‡πà‡∏°‡∏Å‡∏≤‡πÅ‡∏ü <span style="color: red;">*</span></label>
                        <p style="font-size: 0.9rem; color: #666;">(‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡πá‡∏ß)</p>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="caffeine_sensitivity" value="sensitive" required>
                                <span>‡πÑ‡∏ß / ‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (ÎØºÍ∞êÌï®/Ï¶ùÏÉÅÏûàÏùå)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="caffeine_sensitivity" value="not_sensitive">
                                <span>‡πÑ‡∏°‡πà‡πÑ‡∏ß / ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (ÏïàÎØºÍ∞êÌï®/Ï¶ùÏÉÅÏóÜÏùå)</span>
                            </label>
                        </div>
                    </div>

                    <!-- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 3 -->
                    <div class="form-group">
                        <label>3. ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ ‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô <span style="color: red;">*</span></label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="has_condition" value="has_condition" required>
                                <span>‡∏°‡∏µ (ÏûàÏùå)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="has_condition" value="no_condition">
                                <span>‡πÑ‡∏°‡πà‡∏°‡∏µ (ÏóÜÏùå)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
                <div class="form-section">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h3>

                    <div class="form-group">
                        <label>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤, ‡∏ú‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</label>
                        <p style="font-size: 0.9rem; color: #666;">(‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏)</p>
                        <textarea name="sideEffects" id="sideEffects" rows="4" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏™‡πâ ‡∏ß‡∏¥‡∏á‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏®‡∏µ‡∏£‡∏©‡∏∞ ‡∏Ø‡∏•‡∏Ø"></textarea>
                    </div>
                </div>

                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ PDPA -->
                <div class="form-section" style="background: #fff3cd; border-left-color: #ffc107;">
                    <div class="form-group">
                        <label style="display: flex; align-items: flex-start; cursor: pointer;">
                            <input type="checkbox" name="consent" id="consent" required
                                   style="width: 20px; height: 20px; margin-right: 10px; margin-top: 2px; cursor: pointer; flex-shrink: 0;">
                            <span style="flex: 1;">
                                <span style="color: red; font-weight: bold;">[‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô]</span>
                                ‡∏â‡∏±‡∏ô‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô (‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå ‡πÑ‡∏•‡∏ô‡πå‡πÑ‡∏≠‡∏î‡∏µ)
                                ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡πà‡∏≤‡∏ô Meta (Facebook) ‡πÅ‡∏•‡∏∞ Google
                                ‡∏ï‡∏≤‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
                            </span>
                        </label>
                        <p style="font-size: 0.85rem; color: #666; margin-top: 10px; margin-left: 30px;">
                            ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Meta (Facebook) ‡πÅ‡∏•‡∏∞ Google ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏ú‡∏•‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                        </p>
                    </div>
                </div>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° -->
                <button type="submit" class="submit-button">
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
                </button>
            </form>
        </div>

        <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
        <div id="result-container" class="result-container hidden">
            <div class="result-icon"></div>
            <h2 class="result-title">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

            <div class="result-box">
                <p style="font-size: 1.2rem;">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ</p>
                <div class="diagnosis" id="diagnosis-result">-</div>
            </div>

            <!-- Îã§Ïùå Îã®Í≥Ñ ÏïàÎÇ¥ -->
            <div class="line-info">
                <h3 style="color: #333; margin-bottom: 15px; font-size: 1.3rem;">üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ</h3>

                <div style="text-align: left; margin: 20px 0;">
                    <div style="display: flex; align-items: start; margin-bottom: 15px;">
                        <span style="background: #00c851; color: white; width: 30px; height: 30px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0; font-weight: bold;">1</span>
                        <div>
                            <strong style="color: #333;">‡πÄ‡∏û‡∏¥‡πà‡∏° LINE Official Account</strong>
                            <p style="margin: 5px 0 0 0; font-size: 0.95rem; color: #666;">
                                <a href="https://line.me/ti/p/@koreandiet" target="_blank" rel="noopener noreferrer"
                                   style="color: #00c851; text-decoration: underline; font-weight: bold;">
                                    @koreandiet
                                </a>
                            </p>
                        </div>
                    </div>

                    <div style="display: flex; align-items: start; margin-bottom: 15px;">
                        <span style="background: #667eea; color: white; width: 30px; height: 30px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0; font-weight: bold;">2</span>
                        <div>
                            <strong style="color: #333;">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</strong>
                            <p style="margin: 5px 0 0 0; font-size: 0.95rem; color: #666;">
                                ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                            </p>
                        </div>
                    </div>

                    <div style="display: flex; align-items: start; margin-bottom: 15px;">
                        <span style="background: #ffc107; color: white; width: 30px; height: 30px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0; font-weight: bold;">3</span>
                        <div>
                            <strong style="color: #333;">‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</strong>
                            <p style="margin: 5px 0 0 0; font-size: 0.95rem; color: #666;">
                                ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                            </p>
                        </div>
                    </div>

                    <div style="display: flex; align-items: start;">
                        <span style="background: #e91e63; color: white; width: 30px; height: 30px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0; font-weight: bold;">4</span>
                        <div>
                            <strong style="color: #333;">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</strong>
                            <p style="margin: 5px 0 0 0; font-size: 0.95rem; color: #666;">
                                ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£
                            </p>
                        </div>
                    </div>
                </div>

                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #2196f3;">
                    <p style="margin: 0; font-size: 0.9rem; color: #1565c0;">
                        <strong>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤:</strong> ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå-‡∏®‡∏∏‡∏Å‡∏£‡πå 9:00-18:00
                    </p>
                </div>
            </div>

            <a href="https://line.me/ti/p/@koreandiet" target="_blank" rel="noopener noreferrer"
               class="submit-button" style="display: block; text-align: center; text-decoration: none; margin-top: 30px;">
                ‡πÄ‡∏û‡∏¥‡πà‡∏° LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤
            </a>

            <button class="reset-button" onclick="resetForm()" style="margin-top: 15px;">‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà</button>
        </div>
    </div>
    
    <div class="auto-redirect" id="redirectModal">
        <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°...</h3>
        <div class="loading"></div>
        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
    </div>
    
    <script>
        // ====== BMI Í≥ÑÏÇ∞ Î∞è Ïã§ÏãúÍ∞Ñ ÌëúÏãú ======
        const weightInput = document.getElementById('currentWeight');
        const heightInput = document.getElementById('height');
        const bmiDisplay = document.getElementById('bmi-display');
        const bmiValue = document.getElementById('bmi-value');

        function calculateBMI() {
            const weight = parseFloat(weightInput.value);
            const height = parseFloat(heightInput.value);

            if (weight > 0 && height > 0) {
                const heightInMeters = height / 100;
                const bmi = (weight / (heightInMeters * heightInMeters)).toFixed(2);
                bmiValue.textContent = bmi;
                bmiDisplay.classList.remove('hidden');
            } else {
                bmiDisplay.classList.add('hidden');
            }
        }

        weightInput.addEventListener('input', calculateBMI);
        heightInput.addEventListener('input', calculateBMI);

        // ====== ÎùºÎîîÏò§ Î≤ÑÌäº ÏãúÍ∞ÅÏ†Å Ìö®Í≥º ======
        document.querySelectorAll('.radio-option input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // Í∞ôÏùÄ nameÏùò Î™®Îì† ÎùºÎîîÏò§ ÏòµÏÖòÏóêÏÑú selected ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                document.querySelectorAll(`input[name="${this.name}"]`).forEach(r => {
                    r.closest('.radio-option').classList.remove('selected');
                });
                // ÏÑ†ÌÉùÎêú ÏòµÏÖòÏóêÎßå selected ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                this.closest('.radio-option').classList.add('selected');
            });
        });

        // ====== Ìèº Ï¥àÍ∏∞Ìôî Ìï®Ïàò ======
        function resetForm() {
            document.getElementById('diagnosis-form').reset();
            document.getElementById('survey-container').classList.remove('hidden');
            document.getElementById('result-container').classList.add('hidden');
            bmiDisplay.classList.add('hidden');

            // Î™®Îì† ÎùºÎîîÏò§ ÏòµÏÖòÏóêÏÑú selected ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
        }
    </script>
    
<script>
  // ====== Ïú†Ìã∏ ======
  function genEventId() {
    return 'cid-' + Date.now() + '-' + Math.random().toString(36).slice(2,10);
  }
  function getCookie(name) {
    const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + '=([^;]*)'));
    return m ? decodeURIComponent(m[1]) : '';
  }
  function getFbc() {
    // URLÏóê fbclidÍ∞Ä ÏûàÏúºÎ©¥ _fbc ÌòïÏãùÏúºÎ°ú ÏÉùÏÑ±
    const params = new URLSearchParams(location.search);
    const fbclid = params.get('fbclid');
    if (fbclid) return `fb.1.${Date.now()}.${fbclid}`;
    // ÏóÜÏúºÎ©¥ Ïø†ÌÇ§ÏóêÏÑú
    return getCookie('_fbc') || '';
  }

  async function sendLeadToServer(eventId, customerInfo) {
    try {
      console.log('üì® sendLeadToServer() ÏãúÏûë, eventId:', eventId);
      console.log('üë§ Í≥†Í∞ù Ï†ïÎ≥¥:', customerInfo);

      // customerInfoÏóêÏÑú Í∞úÏÑ†Îêú Í≥†Í∞ù Ï†ïÎ≥¥ Ï∂îÏ∂ú
      const email = customerInfo?.email || '';
      const phone = customerInfo?.phone || '';
      const firstName = customerInfo?.firstName || '';
      const lastName = customerInfo?.lastName || '';
      const lineId = customerInfo?.lineId || '';

      const payload = {
        eventId,
        eventSourceUrl: location.href,
        email: email, // Ïù¥Î©îÏùº Ï∂îÍ∞Ä
        phone: phone, // ÌÉúÍµ≠ Íµ≠Í∞ÄÏΩîÎìú Ìè¨Ìï®
        firstName: firstName, // Ïù¥Î¶Ñ (Î∂ÑÎ¶¨)
        lastName: lastName, // ÏÑ± (Î∂ÑÎ¶¨)
        lineId: lineId,
        fbp: getCookie('_fbp') || '',
        fbc: getFbc(),
        userAgent: navigator.userAgent,
        value: 149000, // Î¶¨ÎìúÎãπ Í∞ÄÏπò (ÏõêÌôî)
        currency: 'KRW' // ÌÜµÌôî ÏΩîÎìú
      };

      console.log('üìã Ï†ÑÏÜ°Ìï† payload (Í∞úÏÑ†Îêú Îß§Ïπ≠ Ï†ïÎ≥¥ Ìè¨Ìï®):', payload);
      console.log('üåê /api/lead ÏöîÏ≤≠ ÏãúÏûë...');

      const response = await fetch('/api/lead', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload),
        keepalive: true // ÌÉ≠ Îã´ÌòÄÎèÑ Ï†ÑÏÜ° ÏãúÎèÑ
      });

      console.log('üì° ÏÑúÎ≤Ñ ÏùëÎãµ ÏÉÅÌÉú:', response.status);
      const result = await response.json();
      console.log('üìÑ ÏÑúÎ≤Ñ ÏùëÎãµ ÎÇ¥Ïö©:', result);
      console.log('üîç ÏÉÅÏÑ∏ Meta ÏùëÎãµ:', result.meta);

      if (response.ok) {
        console.log('‚úÖ CAPI Ï†ÑÏÜ° ÏÑ±Í≥µ! (Í≥†Í∞ù Ï†ïÎ≥¥ Ìè¨Ìï®)');
      } else {
        console.log('‚ùå CAPI Ï†ÑÏÜ° Ïã§Ìå®:', result);
      }
    } catch(e) {
      console.error('üö® CAPI Ï†ÑÏÜ° ÏóêÎü¨:', e);
    }
  }

  // ====== Î¶¨Îìú Ï†ÑÏÜ° ÌõÖ(Î≤ÑÌäº/ÌèºÏóê Ïó∞Í≤∞) ======
  function trackLeadWithDedup(customerInfo) {
    console.log('üöÄ trackLeadWithDedup() Ìò∏Ï∂úÎê®');
    console.log('üë§ Ï†ÑÎã¨Î∞õÏùÄ Í≥†Í∞ù Ï†ïÎ≥¥:', customerInfo);

    const eventId = genEventId();
    console.log('üìã ÏÉùÏÑ±Îêú eventId:', eventId);

    // Î∏åÎùºÏö∞Ï†Ä ÌîΩÏÖÄ(Lead)
    if (typeof window.fbq === 'function') {
      console.log('‚úÖ fbq Ìï®Ïàò Ï°¥Ïû¨ - Î∏åÎùºÏö∞Ï†Ä ÌîΩÏÖÄ Ï†ÑÏÜ°');
      fbq('track', 'Lead', { value: 149000, currency: 'KRW' }, { eventID: eventId });
    } else {
      console.log('‚ùå fbq Ìï®Ïàò ÏóÜÏùå');
    }

    // ÏÑúÎ≤Ñ(CAPI) ÎèôÏãú Ï†ÑÏÜ° (Í≥†Í∞ù Ï†ïÎ≥¥ Ìè¨Ìï®)
    console.log('üåê ÏÑúÎ≤Ñ CAPI Ï†ÑÏÜ° ÏãúÏûë (Í≥†Í∞ù Ï†ïÎ≥¥ Ìè¨Ìï®)');
    sendLeadToServer(eventId, customerInfo);
  }

  // ====== ÌïµÏã¨: ÏßÑÎã® Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨ (Ìô©Í∏à Ìï®Ïàò) ======
  const diagnosisForm = document.getElementById('diagnosis-form');
  let isSubmitting = false; // Ï§ëÎ≥µ Ï†úÏ∂ú Î∞©ÏßÄ ÌîåÎûòÍ∑∏

  if (diagnosisForm) {
    diagnosisForm.addEventListener('submit', async function(e) {
      e.preventDefault(); // Ìèº Í∏∞Î≥∏ Ï†úÏ∂ú Î∞©ÏßÄ

      // Ï§ëÎ≥µ Ï†úÏ∂ú Î∞©ÏßÄ
      if (isSubmitting) {
        console.log('‚ö†Ô∏è Ïù¥ÎØ∏ Ï†úÏ∂ú Ï§ëÏûÖÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.');
        return;
      }

      isSubmitting = true;
      const submitButton = diagnosisForm.querySelector('button[type="submit"]');
      const originalButtonText = submitButton.textContent;

      // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Î∞è Î°úÎî© ÌëúÏãú
      submitButton.disabled = true;
      submitButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...'; // "Ï≤òÎ¶¨ Ï§ë..."
      submitButton.style.opacity = '0.6';
      submitButton.style.cursor = 'not-allowed';

      console.log('üöÄ Ìèº Ï†úÏ∂ú ÏãúÏûë');

      // 1. ÌèºÏóêÏÑú Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏùΩÍ∏∞
      const formData = new FormData(diagnosisForm);

      const fullName = formData.get('fullName');
      const lineId = formData.get('lineId');
      const phoneNumber = formData.get('phoneNumber');
      const email = formData.get('email'); // Ïù¥Î©îÏùº Ï∂îÍ∞Ä
      const currentWeight = formData.get('currentWeight');
      const height = formData.get('height');
      const past_med_exp = formData.get('past_med_exp');
      const caffeine_sensitivity = formData.get('caffeine_sensitivity');
      const has_condition = formData.get('has_condition');
      const sideEffects = formData.get('sideEffects');

      // 1-1. Ïù¥Î¶Ñ Î∂ÑÎ¶¨ (ÏÑ± / Ïù¥Î¶Ñ)
      // Í≥µÎ∞±ÏúºÎ°ú Î∂ÑÎ¶¨, ÏóÜÏúºÎ©¥ Ï†ÑÏ≤¥Î•º ÏÑ±(ln)Ïóê ÎÑ£Ïùå
      const nameParts = fullName.trim().split(/\s+/);
      const firstName = nameParts.length > 1 ? nameParts.slice(1).join(' ') : ''; // Ïù¥Î¶Ñ
      const lastName = nameParts[0]; // ÏÑ± (ÎòêÎäî Ï†ÑÏ≤¥ Ïù¥Î¶Ñ)

      // 1-2. Ï†ÑÌôîÎ≤àÌò∏Ïóê ÌÉúÍµ≠ Íµ≠Í∞ÄÏΩîÎìú Ï∂îÍ∞Ä
      // 0ÏúºÎ°ú ÏãúÏûëÌïòÎ©¥ Ï†úÍ±∞ÌïòÍ≥† 66 Ï∂îÍ∞Ä
      let phoneWithCountryCode = phoneNumber.replace(/^0/, ''); // Îß® Ïïû 0 Ï†úÍ±∞
      phoneWithCountryCode = '66' + phoneWithCountryCode; // ÌÉúÍµ≠ Íµ≠Í∞ÄÏΩîÎìú Ï∂îÍ∞Ä

      // 2. BMI Í≥ÑÏÇ∞
      const weight = parseFloat(currentWeight);
      const heightM = parseFloat(height) / 100;
      const bmi = (weight / (heightM * heightM)).toFixed(2);

      // 3. ÌïµÏã¨ ÏßÑÎã® Î°úÏßÅ Ïã§Ìñâ (ÏóÑÍ≤©Ìïú Í∑úÏπô Ï†ÅÏö©)
      let diagnosisResult = "1 Îã®Í≥Ñ"; // Í∏∞Î≥∏Í∞í

      // Í∑úÏπô 1: ÏïàÏ†Ñ Ïö∞ÏÑ† (Ïπ¥ÌéòÏù∏ ÎØºÍ∞ê OR Í∏∞Ï†ÄÏßàÌôòÏù¥ ÏûàÎäî Í≤ΩÏö∞)
      if (caffeine_sensitivity === "sensitive" || has_condition === "has_condition") {
        diagnosisResult = "1 Îã®Í≥Ñ";
      }
      // Í∑úÏπô 2: Í∑úÏπô 1Ïóê Ìï¥ÎãπÌïòÏßÄ ÏïäÎäî Í≤ΩÏö∞
      else {
        if (past_med_exp === "has_experience") {
          diagnosisResult = "2 Îã®Í≥Ñ";
        } else { // past_med_exp === "no_experience"
          diagnosisResult = "1 Îã®Í≥Ñ";
        }
      }

      console.log('‚úÖ ÏßÑÎã® Í≤∞Í≥º:', diagnosisResult);

      // 4. Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ° (Î≥ëÎ†¨ Ï≤òÎ¶¨)
      try {
        // 4-A: Íµ¨Í∏Ä ÏãúÌä∏Î°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°
        const consent = formData.get('consent'); // ÎèôÏùò Ï≤¥ÌÅ¨Î∞ïÏä§ Í∞í ('on' ÎòêÎäî null)

        const sheetPayload = {
          fullName: fullName,
          lineId: lineId,
          phoneNumber: phoneNumber,
          currentWeight: currentWeight,
          height: height,
          bmi: bmi,
          past_med_exp: past_med_exp,
          caffeine_sensitivity: caffeine_sensitivity,
          has_condition: has_condition,
          sideEffects: sideEffects || '',
          diagnosisResult: diagnosisResult,
          consent: consent ? 'yes' : 'no', // ÎèôÏùò Ïó¨Î∂Ä Í∏∞Î°ù (Î≤ïÏ†Å Î≥¥Ìóò)
          submittedAt: new Date().toISOString()
        };

        console.log('üìä Íµ¨Í∏Ä ÏãúÌä∏ Ï†ÑÏÜ° Îç∞Ïù¥ÌÑ∞:', sheetPayload);

        // ÎπÑÎèôÍ∏∞Î°ú Íµ¨Í∏Ä ÏãúÌä∏Ïóê Ï†ÄÏû• (Í≤∞Í≥ºÎ•º Í∏∞Îã§Î¶¨ÏßÄ ÏïäÏùå)
        fetch('/api/saveToSheet', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(sheetPayload),
          keepalive: true
        }).then(response => response.json())
          .then(result => {
            console.log('‚úÖ Íµ¨Í∏Ä ÏãúÌä∏ Ï†ÄÏû• ÏÑ±Í≥µ:', result);
          })
          .catch(error => {
            console.error('‚ùå Íµ¨Í∏Ä ÏãúÌä∏ Ï†ÄÏû• Ïã§Ìå®:', error);
          });

        // 4-B: Î©îÌÉÄ Ï†ÑÌôò Ï∂îÏ†Å Ïã§Ìñâ (Í≥†Í∞ù Ï†ïÎ≥¥ Ìè¨Ìï® - Í∞úÏÑ†Îê®)
        const customerInfo = {
          email: email || '', // Ïù¥Î©îÏùº (ÏÑ†ÌÉù)
          phone: phoneWithCountryCode, // ÌÉúÍµ≠ Íµ≠Í∞ÄÏΩîÎìú Ìè¨Ìï® Ï†ÑÌôîÎ≤àÌò∏
          firstName: firstName, // Ïù¥Î¶Ñ (Î∂ÑÎ¶¨Îê®)
          lastName: lastName, // ÏÑ± (Î∂ÑÎ¶¨Îê®)
          lineId: lineId
        };

        console.log('üéØ Î©îÌÉÄ Ï†ÑÌôò(Pixel + CAPI) Ï∂îÏ†Å Ïã§Ìñâ (Í∞úÏÑ†Îêú Îß§Ïπ≠ Ï†ïÎ≥¥ Ìè¨Ìï®)');
        console.log('üì± Ï†ÑÌôîÎ≤àÌò∏ (Íµ≠Í∞ÄÏΩîÎìú Ìè¨Ìï®):', phoneWithCountryCode);
        console.log('üë§ Ïù¥Î¶Ñ Î∂ÑÎ¶¨ - ÏÑ±:', lastName, '/ Ïù¥Î¶Ñ:', firstName);
        trackLeadWithDedup(customerInfo);

        // 5. ÏÇ¨Ïö©ÏûêÏóêÍ≤å Í≤∞Í≥º ÌôîÎ©¥ Î≥¥Ïó¨Ï£ºÍ∏∞
        document.getElementById('diagnosis-result').textContent = diagnosisResult;
        document.getElementById('survey-container').classList.add('hidden');
        document.getElementById('result-container').classList.remove('hidden');

        // ÌéòÏù¥ÏßÄ ÏÉÅÎã®ÏúºÎ°ú Ïä§ÌÅ¨Î°§
        window.scrollTo({ top: 0, behavior: 'smooth' });

      } catch (error) {
        console.error('üö® Ï†úÏ∂ú Ï§ë ÏóêÎü¨ Î∞úÏÉù:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');

        // ÏóêÎü¨ Î∞úÏÉù Ïãú Î≤ÑÌäº Îã§Ïãú ÌôúÏÑ±Ìôî
        isSubmitting = false;
        submitButton.disabled = false;
        submitButton.textContent = originalButtonText;
        submitButton.style.opacity = '1';
        submitButton.style.cursor = 'pointer';
      }
    });
  }
</script>
</body>
</html>